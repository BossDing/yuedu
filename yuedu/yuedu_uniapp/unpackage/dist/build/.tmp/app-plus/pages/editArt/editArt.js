(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/editArt/editArt"],{"1a88":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"a",function(){return a}),n.d(e,"b",function(){return i})},"6a41":function(t,e,n){"use strict";n.r(e);var a=n("d664"),i=n.n(a);for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);e["default"]=i.a},b5c4:function(t,e,n){"use strict";(function(t){n("075a"),n("921b");a(n("66fd"));var e=a(n("cd4d"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},cd4d:function(t,e,n){"use strict";n.r(e);var a=n("1a88"),i=n("6a41");for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);var s=n("2877"),d=Object(s["a"])(i["default"],a["a"],a["b"],!1,null,null,null);e["default"]=d.exports},d664:function(t,e,n){"use strict";(function(t){var n,a,i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{title:"",artList:[],inputContent:"",needUploadImg:[],uploadIndex:0,caties:[{cate_id:0,cate_pid:0,cate_name:"请选择",cate_order:1}],currentCateIndex:0,catiesFromApi:[],sedCateIndex:0,art_id:0,art_uid:0}},methods:{cateChange:function(t){this.currentCateIndex=t.detail.value,this.sedCateIndex=this.caties[this.currentCateIndex].cate_id},deleteText:function(e){var n=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(n,1)}})},submit:function(e){var n=e.detail.value.artText;n.length<1?t.showToast({title:"请输入内容",icon:"none"}):(this.artList.push({type:"text",content:n}),this.inputContent="")},addImg:function(){i=this,t.chooseImage({count:1,sizeType:["compressed"],success:function(t){i.artList.push({type:"image",content:t.tempFilePaths[0]})}})},submitNow:function(){if(this.title.length<2)t.showToast({title:"请输入标题",icon:"none"});else if(this.artList.length<1)t.showToast({title:"请填写文章内容",icon:"none"});else if(this.sedCateIndex<1)t.showToast({title:"请选择分类",icon:"none"});else{this.needUploadImg=[];for(var e=0;e<this.artList.length;e++)"image"==this.artList[e].type&&this.needUploadImg.push({tmpurl:this.artList[e].content,indexID:e});this.uploadImg()}},uploadImg:function(){if(this.needUploadImg.length<1||this.uploadIndex>=this.needUploadImg.length)return t.showLoading({title:"正在提交..."}),void t.request({url:this.ctx+"articles/updateArticle",method:"POST",data:{art_id:i.art_id,art_title:i.title,art_content:JSON.stringify(i.artList),art_uid:a[0],art_cate:i.sedCateIndex},success:function(e){"ok"==e.data.msg?(t.showToast({title:"提交成功",icon:"none"}),i.artList=[],i.currentCateIndex=0,i.sedCateIndex=0,i.needUploadImg=[],i.title="",t.hideLoading(),setTimeout(function(){t.switchTab({url:"../my/my"})},1e3)):t.showToast({title:e.data.data,icon:"none"})},fail:function(t){},complete:function(){}});t.showLoading({title:"上传图片"});t.uploadFile({url:i.ctx+"fileUpload",filePath:i.needUploadImg[i.uploadIndex].tmpurl,name:"file",success:function(t){t=t.data;var e=i.needUploadImg[i.uploadIndex].indexID;i.artList[e].content=i.ctx+t,i.uploadIndex++,setTimeout(function(){i.uploadImg()},1e3)},fail:function(){t.showToast({title:"上传图片失败,请重试!",icon:"none"})}})},removeImg:function(e){var n=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(n,1)}})}},onLoad:function(e){if(i=this,n=e.artId,a=this.checkLogin("../editArt/editArt","2"),!a)return!1;t.request({url:i.ctx+"articles/getArticleById?id="+n,method:"GET",data:{},success:function(t){i.artList=JSON.parse(t.data.art_content),i.title=t.data.art_title;for(var e=0;e<i.caties.length;e++)i.caties[e].cate_id==t.data.art_cate&&(i.currentCateIndex=e);i.art_id=t.data.art_id,i.art_uid=t.data.art_uid,i.sedCateIndex=t.data.art_cate}}),t.request({url:this.ctx+"categories/getAll",method:"GET",data:{},success:function(t){t=t.data;for(var e=0;e<t.length;e++)i.caties.push(t[e])},fail:function(){},complete:function(){}})}};e.default=o}).call(this,n("6e42")["default"])}},[["b5c4","common/runtime","common/vendor"]]]);